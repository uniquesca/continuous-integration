name: Prepare release

on:
  push:
    branches:
      - 'feature/release-workflow'
  pull_request:
    branches:
      - 'develop'

  workflow_call:
    inputs:
      version:
        description: 'fix this later'
        required: false
        default: '1.0.21'
        type: string
      generate_changelog:
        required: false
        default: true
        type: boolean
      update_db:
        required: false
        default: false
        type: boolean
      db_dump_path:
        required: false
        type: string
      migration_command:
        required: false
        default: './vendor/bin/phinx migrate'
        type: string

jobs:
  prepare-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Update package version
        run: |
          #if [ -f "package.json" ]; then
            #npm pkg version
            #git add package.json
          #fi

      - name: Update changelog file
        #if: ${{ -f "package.json" && inputs.generate_changelog == "true" }}
        uses: uniquesca/continuous-integration/update-changelog@main
        with:
          target_version: '1.0.0'

      - name: Update DB dump
        #if: ${{ inputs.update_db }} == true && [ -f "inputs.db_dump_path" ]
        run: |
          #in progress
          #con${{ inputs.migration_command }}
          #git add db_dump.sql